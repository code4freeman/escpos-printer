# escpos 小票打印机研究

关于宽度：   
~~打印机型号标称宽度80MM，我在测试中（左边距、打印宽度）实际得出打印宽度按70mm整好匹配。建议在后面的命令中按70mm来算~~   
！！！左右间距强烈建议按最大字符宽度来计算得出，不要用上一行所提到的宽度来计算。   

关于一行打印字符数量：   
亲测，打印英文一行为最多47个（在宽度为70MM时， 宽度设置为80mm则为48个）；中文一个字符相当于英文2个字符的位置。   
在进行列表打印时， 每行的打印就要计算字符数量来评分位置了，建议写一个函数计算宽度（中英文区别计算，因为宽度不同）。   



toRaster
```

- - - - - - - - | - - - - - - - - | - - - - - - - - 
- - - - - - - - | + - - - - - - - | - - - - - - - -     i = (x1 * 8 + b0) = 8  // 求当前处于当前行的第几个索引
- - - - - - - - | - - - - - - - - | - - - - - - - -     
- - - - - - - - | - - - - - - - - | - - - - - - - - 

result[y * n + x] === undefined
         
         ^
     y1 * n3 + x1 = 4 // 求当前处于全部数据中的第几个单元格


c = x * 8 + b; // 同样求当前行中的真实索引
if (c < width) {
    if (data[y * width + i]) {
                ^
            y1 * width24 + i8 = // 得出真实索引

            result[y * n + x]       +=     (0x80 >> (b & 0x7));
                        ^                         ^
                 每个单元格一个数据           (128 >> (0 & 7)) = 128

    }
}

```


toBitmap
```

density = 24
c = (density / 8) = 3
n = Math.ceil(height / density) = 1;

|+-------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
i = x0 * c3 + (b0 >> 3) = 0 //真实的索引为0

|--------|+-------|--------|^-------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
i = x8 * c3 + (b0 >> 3) = 24 // 真实的索引^为24

|--------|--------|+-------|--------|
|--------|--------|^-------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
|--------|--------|--------|--------|
i = x16 * c3 + (b0 >> 3) = 48 // 真实的索引^为48

更多...

if (ld[i] === undefind) ld[i] = 0


//以上图1为例
l = (y0 * density24 + b0) = 0
//以上图2为例
l = (y0 * density24 + b0) = 0


// 自己总结的思路：
假如这里黑白图像二进制数据：
|00000001|00000001|00000001|00000001|00000001|00000001|
|00000010|00000010|00000010|00000010|00000010|00000010|
|00000100|00000100|00000100|00000100|00000100|00000100|
|00001000|00001000|00001000|00001000|00001000|00001000|

//传向打印机的数据顺序应为：   
【行|列】： [0|0][1|0][2|0] - [0|1][1|1][2|1] .... 依次类推

```